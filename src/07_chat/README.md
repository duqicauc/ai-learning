# 聊天演示 (Chat Demos)

本目录包含两个AI聊天演示脚本，展示如何使用OpenAI兼容的API进行对话。

## 文件说明

### 1. `chatDemo.py` - 简单聊天演示
- **功能**: 发送单次聊天请求并获取完整回复
- **特点**: 简单直接，适合基础API调用学习
- **输出**: 一次性显示完整的AI回复

### 2. `chatStreamDemo.py` - 流式聊天演示  
- **功能**: 实现流式聊天，实时显示AI回复
- **特点**: 模拟真实聊天体验，逐字显示回复
- **输出**: 实时流式显示AI回复内容

### 3. `chatReasoningDemo.py` - 思维链推理演示
- **功能**: 展示AI的思维推理过程和最终回答
- **特点**: 使用DeepSeek-R1模型，显示推理步骤
- **输出**: 分别显示思考过程和最终回复

### 4. `chatMultiDemo.py` - 多轮对话演示
- **功能**: 支持连续对话和对话历史管理
- **特点**: 交互式多轮对话，支持多种命令操作
- **输出**: 实时交互式对话界面
- **特色功能**:
  - `/history` - 查看对话历史
  - `/clear` - 清空对话历史  
  - `/help` - 显示帮助信息
  - `/quit` 或 `/exit` - 退出程序
- **模式选择**: 支持单轮和多轮对话模式选择

### 5. `chatMultiAdvanceDemo.py` - 高级多轮对话演示 🆕
- **功能**: 智能Token管理和对话历史压缩
- **特点**: 防止Token溢出，自动对话精简
- **核心特性**:
  - 🧮 **Token计数监控**: 实时监控对话Token使用量
  - 🔄 **智能压缩**: 每N轮自动压缩对话历史
  - 📝 **对话摘要**: AI生成对话摘要保留关键信息
  - 📊 **统计信息**: 详细的Token使用和对话统计
  - ⚙️ **可配置参数**: 自定义Token限制和压缩间隔
- **高级命令**:
  - `/stats` - 查看详细Token统计
  - `/history` - 查看压缩后的对话历史
  - `/clear` - 清空对话历史
  - `/help` - 显示帮助信息
  - `/quit` 或 `/exit` - 退出程序

## 技术特性

### 🔧 SSL问题修复
两个脚本都包含了SSL证书验证绕过功能，解决了常见的证书验证错误：
```python
http_client = httpx.Client(verify=False, timeout=30.0)
```

### 🛡️ 错误处理
- 完整的异常捕获和处理
- 详细的错误信息和解决建议
- 资源清理和连接管理

### 🌐 API配置
- 使用SiliconFlow API (https://api.siliconflow.cn/v1)
- 支持Qwen/Qwen2.5-7B-Instruct模型
- 可配置的温度和最大token数

## 运行演示

### 运行基础聊天演示
```bash
python chatDemo.py
```

### 运行流式聊天演示
```bash
python chatStreamDemo.py
```

### 运行思维链推理演示
```bash
python chatReasoningDemo.py
```

### 运行多轮对话演示
```bash
python chatMultiDemo.py
```

### 运行多轮对话自动化测试
```bash
python ../../tests/chat/test_multi_chat.py
```

### 运行高级多轮对话演示
```bash
python chatMultiAdvanceDemo.py
```

### 运行高级多轮对话功能测试
```bash
python ../../tests/chat/test_advance_chat.py
```

### 运行基本功能测试
```bash
python ../../tests/chat/test_basic_functionality.py
```

## 输出示例

### chatDemo.py 输出
```
🚀 开始聊天演示...
🔗 连接到 SiliconFlow API...
💬 AI回复：
你好！我是一款由阿里云开发的大型语言模型...
✅ 聊天演示完成！
```

### chatStreamDemo.py 输出
```
🚀 Starting streaming chat demo...
🔗 Connecting to SiliconFlow API...
💬 AI回复：
你好！我是一个专业的AI助手...
✅ 流式对话演示完成！
📝 完整回复长度: 98 字符
```

### chatReasoningDemo.py 输出
```
开始思维链推理演示...
连接到 SiliconFlow API...

=== 思考过程 ===
用户发来一个简单的问候和自我介绍请求。这可能是第一次使用AI助手的新用户...
考虑到"简单介绍"这个关键词，需要避免技术性描述...

=== 最终回答 ===
你好！我是由深度求索（DeepSeek）研发的智能助手，名字叫 DeepSeek-R1...
我目前是免费使用的，支持上传文件，也支持128K超长上下文记忆...

演示完成。思考过程长度: 287 字符，回答长度: 375 字符
```

### chatMultiDemo.py 输出
```
🎯 聊天演示程序
==============================
请选择演示模式:
1. 单轮对话演示
2. 多轮对话演示
3. 退出程序
==============================
请输入选择 (1-3): 2

🚀 启动多轮对话演示...
🚀 多轮对话演示启动...
🔗 连接到 SiliconFlow API...

==================================================
💬 多轮对话模式
==================================================
📝 可用命令:
   - 直接输入文字进行对话
   - '/history' - 查看对话历史
   - '/clear' - 清空对话历史
   - '/help' - 显示帮助信息
   - '/quit' 或 '/exit' - 退出程序
==================================================

[第1轮] 您: 你好
🤖 AI正在思考...
🤖 AI: 你好！我是AI助手，很高兴为您服务...

[第2轮] 您: 你能帮我做什么？
🤖 AI正在思考...
🤖 AI: 我可以帮您回答问题、提供信息、协助学习...
```

### chatMultiAdvanceDemo.py 输出
```
🎯 高级聊天演示程序
========================================
请选择演示模式:
1. 交互式高级多轮对话
2. 自动压缩功能测试
3. 退出程序
========================================
请输入选择 (1-3): 1

🚀 启动交互式高级多轮对话...
🚀 高级多轮对话演示启动...
🔗 连接到 SiliconFlow API...

============================================================
💬 高级多轮对话模式 (智能Token管理)
============================================================
📝 可用命令:
   - 直接输入文字进行对话
   - '/history' - 查看对话历史和token统计
   - '/stats' - 查看详细统计信息
   - '/clear' - 清空对话历史
   - '/help' - 显示帮助信息
   - '/quit' 或 '/exit' - 退出程序
============================================================
⚙️  配置: 最大2000 tokens，每3轮自动精简

[第1轮] 您 (30 tokens): 你好，我想学习Python
🤖 AI正在思考...
🤖 AI: 你好！Python是一门非常适合初学者的编程语言...

📊 第3轮对话完成
   当前token数：1650

🔄 正在压缩对话历史...
   压缩前：7 条消息
   压缩后：4 条消息
   📝 生成摘要：用户询问Python学习相关问题，AI提供了学习建议...

[第4轮] 您 (890 tokens): /stats
📊 详细统计信息:
   - 对话轮数: 3
   - 消息总数: 6
   - 当前tokens: 890
   - 最大tokens: 2000
   - 使用率: 44.5%
```

## 配置说明

### API密钥配置
当前使用硬编码的API密钥，生产环境建议使用环境变量：
```python
api_key = os.getenv("SILICONFLOW_API_KEY", "your-api-key")
```

### 模型选择
可以修改模型参数来使用不同的AI模型：
```python
model="Qwen/Qwen2.5-7B-Instruct"  # 当前使用
model="Qwen/Qwen-72B-Chat"        # 更大模型
```

### 对话内容自定义
修改 `messages` 数组来自定义对话内容：
```python
messages=[
    {"role": "system", "content": "你是一个专业的AI助手"},
    {"role": "user", "content": "你的问题"},
]
```

### 高级多轮对话配置
`chatMultiAdvanceDemo.py` 支持以下配置参数：
```python
# 创建高级聊天管理器
chat_manager = AdvancedChatManager(
    max_tokens=4000,        # 最大Token数限制
    summarize_interval=5    # 每隔多少轮进行对话精简
)
```

**配置说明**:
- `max_tokens`: 对话历史的最大Token数，达到80%时触发压缩
- `summarize_interval`: 压缩间隔，每N轮对话后检查是否需要压缩
- 压缩策略: 保留系统消息、最近2轮对话，其余内容生成摘要

## 故障排除

### 常见问题
1. **SSL证书错误**: 脚本已包含SSL绕过功能
2. **网络连接问题**: 检查网络连接或尝试使用VPN
3. **API密钥无效**: 验证API密钥是否正确和有效
4. **模型不存在**: 确认使用的模型名称是否正确

### 调试建议
- 检查网络连接状态
- 验证API端点是否可访问
- 确认API密钥权限和额度
- 查看详细的错误信息

## 扩展功能

### 可以添加的功能
- 多轮对话支持
- 对话历史保存
- 不同API提供商支持
- 配置文件管理
- 更丰富的错误处理

这些演示为学习AI API集成提供了良好的起点！